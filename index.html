<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Раскраска по ответам — Котик</title>
<style>
  :root{
    --text:#ffffff;
    --muted: rgba(255,255,255,.72);
    --ok:#2de2b7;
    --bad:#ff5c7a;

    /* неоновая рамка */
    --neon1:#00f5ff;
    --neon2:#ff4dff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background: transparent; /* ✅ полностью прозрачный */
    color: var(--text);
  }

  /* 16:9 рабочая сцена */
  .stage169{
    width: 100vw;
    height: 100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 16px;
    background: transparent; /* ✅ без оттенков */
  }

  .layout{
    width: min(1200px, 100%);
    aspect-ratio: 16 / 9;
    display:grid;
    grid-template-columns: 360px 1fr;
    gap: 16px;
    background: transparent; /* ✅ без оттенков */
  }

  /* левая панель — без фона вообще */
  .panel{
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
  }

  h1{
    margin:0 0 10px;
    font-size:18px;
    font-weight:900;
    letter-spacing:.2px;
  }

  .hint{
    margin:0 0 14px;
    color: var(--muted);
    font-size:14px;
    line-height:1.35;
  }

  .task{
    font-size: 30px;
    font-weight: 950;
    margin: 4px 0 12px;
  }

  input,button{width:100%;padding:12px 12px;border-radius:12px;border:0;outline:none;font:inherit}
  input{
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.18);
    color: var(--text);
  }
  input::placeholder{color: rgba(255,255,255,.55)}

  .row{display:flex;gap:10px;margin-top:10px}
  .row>button{flex:1}

  button{
    background: var(--ok);
    color:#062018;
    font-weight: 900;
    cursor:pointer;
  }
  button.secondary{
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.18);
    color: var(--text);
    font-weight: 850;
  }

  .paint{
    margin-top: 14px;
    display:flex;
    align-items:center;
    gap:10px;
    padding: 10px 12px;
    border-radius: 12px;
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.14);
  }
  .dot{
    width: 18px;height:18px;border-radius: 6px;
    border: 2px solid rgba(255,255,255,.35);
  }

  .msg{
    margin-top: 10px;
    font-weight: 900;
  }
  .msg.ok{color: var(--ok)}
  .msg.bad{color: var(--bad)}
  .msg.muted{color: var(--muted); font-weight: 700}

  /* справа — "картина" в неоновой рамке */
  .frame{
    position:relative;
    border-radius: 18px;
    padding: 10px;
    background: transparent;
  }

  .frame::before{
    content:"";
    position:absolute;
    inset: 0;
    border-radius: 18px;
    background:
      linear-gradient(135deg, rgba(0,245,255,.95), rgba(255,77,255,.95));
    filter: blur(0px);
    opacity: 1;
    z-index: 0;
  }

  .frame::after{
    content:"";
    position:absolute;
    inset: -6px;
    border-radius: 22px;
    background:
      linear-gradient(135deg, rgba(0,245,255,.75), rgba(255,77,255,.75));
    filter: blur(16px);
    opacity: .75;
    z-index: 0;
  }

  .canvas{
    position:relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    border-radius: 14px;
    overflow:hidden;
    background: rgba(255,255,255,.02);
    border: 1px solid rgba(255,255,255,.12);
  }

  /* под картинку 3:4 внутри 16:9 */
  .wrap{
    position:absolute;
    inset: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 10px;
  }

  .art{
    position:relative;
    width: min(86%, 560px);
    aspect-ratio: 3 / 4;
    background: transparent;
    border-radius: 14px;
    overflow:hidden;
  }

  .art img{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit: contain;
    display:block;
    background: transparent;
  }
  .art svg{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
  }

  .number{
    font-weight: 950;
    font-size: 42px;
    paint-order: stroke;
    stroke: rgba(255,255,255,.95);
    stroke-width: 6;
    fill: rgba(10,10,14,.9);
    user-select:none;
    pointer-events:none;
  }

  @media (max-width: 980px){
    .layout{
      grid-template-columns: 1fr;
      aspect-ratio: auto;
    }
    .frame{min-height: 60vh}
  }
</style>
</head>
<body>

<div class="stage169">
  <div class="layout">
    <div class="panel">
      <h1>Раскраска по ответам</h1>
      <p class="hint">Реши пример → появится краска → нажми на шарик с этим ответом.</p>

      <div class="task" id="taskText">—</div>

      <input id="ans" inputmode="numeric" placeholder="Введи ответ" />

      <div class="row">
        <button id="checkBtn">Проверить</button>
        <button id="nextBtn" class="secondary">Дальше</button>
      </div>

      <div id="paintBox"></div>
      <div id="msg" class="msg muted"></div>
    </div>

    <div class="frame">
      <div class="canvas">
        <div class="wrap">
          <div class="art">
            <img id="img" alt="Котик" />
            <svg id="svg" viewBox="0 0 1000 1400" preserveAspectRatio="xMidYMid meet"></svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const IMAGE_URL = "https://i.ibb.co/B5wHGTfh/d5e6afa4-eef8-4359-bc47-7ca55574f6ed.jpg";

  // 5 примеров (таблица умножения)
  const tasks = [
    { task: "2 × 6 = ?", answer: "12", color: "#ff4d6d", alpha: 0.50 },
    { task: "3 × 4 = ?", answer: "12", color: "#ff4d6d", alpha: 0.50 }, // повтор 12
    { task: "5 × 3 = ?", answer: "15", color: "#2de2b7", alpha: 0.45 },
    { task: "7 × 2 = ?", answer: "14", color: "#ffd166", alpha: 0.50 },
    { task: "9 × 2 = ?", answer: "18", color: "#6c8cff", alpha: 0.45 },
  ];

  const els = {
    img: document.getElementById("img"),
    svg: document.getElementById("svg"),
    taskText: document.getElementById("taskText"),
    ans: document.getElementById("ans"),
    checkBtn: document.getElementById("checkBtn"),
    nextBtn: document.getElementById("nextBtn"),
    paintBox: document.getElementById("paintBox"),
    msg: document.getElementById("msg"),
  };

  // ====== Совпадение областей с object-fit: contain ======
  let containTF = null;

  function getContainTransform(imgW, imgH, vbW=1000, vbH=1400){
    const s = Math.min(vbW / imgW, vbH / imgH);
    const drawnW = imgW * s;
    const drawnH = imgH * s;
    const offX = (vbW - drawnW) / 2;
    const offY = (vbH - drawnH) / 2;
    return { s, offX, offY, drawnW, drawnH };
  }

  function buildNormTF(imgW, imgH){
    const t = getContainTransform(imgW, imgH, 1000, 1400);
    const sNorm = t.drawnW / 1000; // коэффициент для "условных" точек 1000x1400
    return { offX: t.offX, offY: t.offY, sNorm };
  }

  function mapPtsToViewBox(pts, tf){
    return pts.map(p => ({
      x: tf.offX + p.x * tf.sNorm,
      y: tf.offY + p.y * tf.sNorm
    }));
  }

  // ====== Геометрия ======
  function polyCircle(cx, cy, r, n){
    const pts = [];
    for(let i=0;i<n;i++){
      const a = (Math.PI*2*i)/n;
      pts.push({x: cx + Math.cos(a)*r, y: cy + Math.sin(a)*r});
    }
    return pts;
  }

  function hexToRgba(hex, a){
    const h = String(hex||"#000000");
    const r = parseInt(h.slice(1,3),16)||0;
    const g = parseInt(h.slice(3,5),16)||0;
    const b = parseInt(h.slice(5,7),16)||0;
    return `rgba(${r},${g},${b},${a})`;
  }

  function center(pts){
    let x=0,y=0;
    for(const p of pts){ x+=p.x; y+=p.y; }
    return {x:x/pts.length, y:y/pts.length};
  }

  function getColorForAnswer(ans){
    const t = tasks.find(x => String(x.answer) === String(ans));
    return t ? {color:t.color, alpha:t.alpha} : {color:"#2de2b7", alpha:0.45};
  }

  function setMsg(text, kind){
    els.msg.textContent = text || "";
    els.msg.className = "msg " + (kind || "muted");
  }

  // ====== Области (5 шариков) ======
  const regions = [
    { id:"r1", answer:"12", points: polyCircle(380, 285, 125, 56) }, // верхний левый
    { id:"r2", answer:"12", points: polyCircle(620, 285, 125, 56) }, // верхний правый
    { id:"r3", answer:"15", points: polyCircle(305, 430, 135, 56) }, // левый средний
    { id:"r4", answer:"14", points: polyCircle(500, 410, 140, 60) }, // центральный
    { id:"r5", answer:"18", points: polyCircle(695, 430, 135, 56) }, // правый средний
  ].map(r => ({...r, filled:false}));

  let taskIndex = 0;
  let activeAnswer = null;

  function render(){
    els.svg.innerHTML = "";
    const tf = containTF;

    for(const r of regions){
      const ptsVB = tf ? mapPtsToViewBox(r.points, tf) : r.points;

      const poly = document.createElementNS("http://www.w3.org/2000/svg","polygon");
      poly.setAttribute("points", ptsVB.map(p=> `${p.x},${p.y}`).join(" "));

      if(r.filled){
        const {color, alpha} = getColorForAnswer(r.answer);
        poly.setAttribute("fill", hexToRgba(color, alpha));
      } else {
        poly.setAttribute("fill", "rgba(0,0,0,0)");
      }

      poly.setAttribute("stroke","transparent");
      poly.setAttribute("stroke-width","0");
      poly.style.cursor = activeAnswer ? "pointer" : "default";

      poly.addEventListener("click", () => {
        if(!activeAnswer) return;
        if(String(r.answer) !== String(activeAnswer)) return;
        r.filled = true;
        setMsg("Закрашено!", "ok");
        render();
      });

      els.svg.appendChild(poly);

      if(!r.filled){
        const c = center(ptsVB);
        const t = document.createElementNS("http://www.w3.org/2000/svg","text");
        t.textContent = r.answer;
        t.setAttribute("x", c.x);
        t.setAttribute("y", c.y);
        t.setAttribute("text-anchor","middle");
        t.setAttribute("dominant-baseline","middle");
        t.setAttribute("class","number");
        els.svg.appendChild(t);
      }
    }

    renderPaint();
  }

  function renderPaint(){
    els.paintBox.innerHTML = "";
    if(!activeAnswer){
      setMsg("", "muted");
      return;
    }
    const {color} = getColorForAnswer(activeAnswer);

    const box = document.createElement("div");
    box.className = "paint";

    const dot = document.createElement("div");
    dot.className = "dot";
    dot.style.background = color;

    const label = document.createElement("div");
    label.innerHTML = `<div style="font-weight:950">Краска готова</div>
                       <div style="color:var(--muted);font-size:13px;margin-top:2px">Нажми на шарик с ответом ${activeAnswer}</div>`;

    box.appendChild(dot);
    box.appendChild(label);
    els.paintBox.appendChild(box);
  }

  function showTask(){
    const t = tasks[taskIndex % tasks.length];
    els.taskText.textContent = t.task;
    els.ans.value = "";
    activeAnswer = null;
    els.paintBox.innerHTML = "";
    setMsg("", "muted");
    render();
  }

  function check(){
    const user = String(els.ans.value||"").trim();
    const t = tasks[taskIndex % tasks.length];

    if(user && user === String(t.answer)){
      activeAnswer = String(t.answer);
      setMsg("Правильно!", "ok");
      render();
    } else {
      setMsg("Попробуй ещё раз.", "bad");
      els.ans.value = "";
    }
  }

  function next(){
    taskIndex++;
    showTask();
  }

  els.checkBtn.addEventListener("click", check);
  els.nextBtn.addEventListener("click", next);
  els.ans.addEventListener("keydown", (e)=>{ if(e.key==="Enter") check(); });

  els.img.onload = () => {
    const iw = els.img.naturalWidth || 1000;
    const ih = els.img.naturalHeight || 1400;
    containTF = buildNormTF(iw, ih);
    render();
  };
  els.img.src = IMAGE_URL + "?v=" + Date.now();

  showTask();
})();
</script>
</body>
</html>
